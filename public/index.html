<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>CogComp-NLP demo</title>

    <link rel="stylesheet" type="text/css" href="./brat_client/static/style-vis.css"/>
    <link rel="stylesheet" type="text/css" href="./main.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.0/gh-fork-ribbon.min.css"/>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/css/bootstrap-select.min.css">


    <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/headjs/1.0.3/head.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.12.2/js/bootstrap-select.min.js"></script>
    <script src="/apelles.js" type="text/javascript"></script>

    <!--for code highlighting -->
    <link rel="stylesheet"
          href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <a href="https://github.com/CogComp/cogcomp-nlp/" class="github-corner" aria-label="View source on Github">
      <svg width="80" height="80" viewBox="0 0 250 250"
           style="height: 100px; width: 100px; fill:#000000; color:#fff; position: absolute; top: 0; right: 0; border: 0;"
           aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path
          d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
          fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path
          d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
          fill="currentColor" class="octo-body"></path>
      </svg>
    </a>
    <style>.github-corner:hover .octo-arm {
    animation: octocat-wave 560ms ease-in-out
}

@keyframes octocat-wave {
    0%, 100% {
        transform: rotate(0)
    }
    20%, 60% {
        transform: rotate(-25deg)
    }
    40%, 80% {
        transform: rotate(10deg)
    }
}

@media (max-width: 500px) {
    .github-corner:hover .octo-arm {
        animation: none
    }

    .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
    }
}</style>
    <div class="container">
      <div class="jumbotron" style="position: relative">
        <div style="float: right">
          <iframe
            src="https://ghbtns.com/github-btn.html?user=CogComp&repo=cogcomp-nlp&type=star&count=true&size=large"
            frameborder="0" scrolling="0" width="160px" height="30px" style="margin-right: -20px"></iframe>
          <iframe
            src="https://ghbtns.com/github-btn.html?user=CogComp&repo=cogcomp-nlp&type=fork&count=true&size=large"
            frameborder="0" scrolling="0" width="158px" height="30px" style="margin-right: -20px"></iframe>
        </div>
        <h1><a href="/" style="text-decoration: none">CogComp-NLP</a></h1>
        <p>
          CogComp-NLP provides a suite of state-of-the-art Natural Language Processing (NLP) tools
          that allows you to annotate plain text inputs.
          <div class="wrap">
            <p>
              <img src="java.png" style="height: 40px"/>
              Java user? We have a JVM API!
              <button type="button" data-toggle="collapse" data-target="#collapse1"
                      class="btn btn-success btn-xs">More</button>
            </p>
            <p>
              <img src="python.png" style="height: 40px"/>
              Python user? We have a Python API!
              <button type="button" data-toggle="collapse" data-target="#collapse2"
                      class="btn btn-success btn-xs" onClick="document.getElementById('bottom').scrollIntoView();" >More</button>
            </p>
            <ul class="list-group" style="position: absolute; right: 80px; top: 245px; width: 260px">
              <li class="list-group-item">
                <span class="badge" id="pipeline-version"></span>
                Pipeline version in this demo
              </li>
            </ul>
            <div style="clear: both;"></div>
	  </div>
	</p>
	<div id="loader_container" style="height: 30px; margin-left: 50%">
          <div class="loader" id="loader-main"></div>
	</div>
      </div>
      <div id="main-content" style="overflow: visible;">
	  Enter text to annotate below <span style="font-size: smaller">(1500 characters limit)</span>, or select a
          sample document:
		
		
			<div class="row">
				<div class="col-md-4">
					<select class="selectpicker" id="view-selector" multiple data-actions-box="true" data-live-search="true"
					data-header="Select at least one annotator" multiple>
						<option value="LEMMA">LEMMA</option>
						<option value="POS" selected>POS</option>
						<option value="SHALLOW_PARSE">Shallow Parse</option>
						<option value="MENTION">Mention Detection</option>
						<option value="RELATION">Relation Extraction (ACE-2005)</option>
						<option value="NER_CONLL">NER (CoNLL)</option>
						<option value="NEURAL_XEL" id="neural-xel-opt">Cross-lingual Entity Linking (XEL)</option>
						<option value="HMA_TRANSLIT" id="hma-trans-opt">Transliteration (HMA-Seq2Seq)</option>
						<option value="NER_ONTONOTES">NER (Ontonotes)</option>
						<option value="TIMEX3">Temporal Normalizer</option>
						<option value="QUESTION_TYPE">Question Type</option>
						<option value="SRL_NOM">SRL (Nom)</option>
						<option value="SRL_VERB">SRL (Verb)</option>
						<option value="PATH_LSTM_SRL">SRL (Path-LSTM)</option>
						<option value="SRL_PREP">SRL (preposition)</option>
						<option value="SRL_COMMA">SRL (Comma)</option>
						<option value="QUANTITIES">Quantities</option>
						<option value="DEPENDENCY">Dependency Tree</option>
						<option value="TRANSLITERATION" id="trans-opt">Transliteration</option>
						<option data-divider="true"></option>
						<option value="DEPENDENCY_STANFORD">Dependency Tree (Stanford)</option>
						<option value="STANFORD_COREF">Co-reference (Stanford)</option>
						<option value="STANFORD_RELATIONS">Relations (Stanford)</option>
						<option value="STANFORD_OPENIE">Open IE (Stanford)</option>
					</select>
					<div id="transliteration-selector-div" style="display: none">
						<select class="selectpicker" id="transliteration-selector" data-actions-box="true" data-live-search="true"
							data-header="Transliteration Language: ">
							<option style="display:none" value="TRANSLITERATION" selected></option>
							<option value="TRANSLITERATION_abk">Abkhazian</option>
							<option value="TRANSLITERATION_afr">Afrikaans</option>
							<option value="TRANSLITERATION_ara">Arabic</option>
							<option value="TRANSLITERATION_arg">Aragonese</option>
							<option value="TRANSLITERATION_arz">Egyptian_Arabic</option>
							<option value="TRANSLITERATION_ast">Asturian</option>
							<option value="TRANSLITERATION_aze">Azerbaijani</option>
							<option value="TRANSLITERATION_bak">Bashkir</option>
							<option value="TRANSLITERATION_bel">Belarusian</option>
							<option value="TRANSLITERATION_ben">Bengali</option>
							<option value="TRANSLITERATION_bos">Bosnian</option>
							<option value="TRANSLITERATION_bre">Breton</option>
							<option value="TRANSLITERATION_bul">Bulgarian</option>
							<option value="TRANSLITERATION_cat">Valencian</option>
							<option value="TRANSLITERATION_ces">Czech</option>
							<option value="TRANSLITERATION_che">Chechen</option>
							<option value="TRANSLITERATION_chv">Chuvash</option>
							<option value="TRANSLITERATION_ckb">Sorani</option>
							<option value="TRANSLITERATION_dan">Danish</option>
							<option value="TRANSLITERATION_ell">Greek</option>
							<option value="TRANSLITERATION_epo">Esperanto</option>
							<option value="TRANSLITERATION_est">Estonian</option>
							<option value="TRANSLITERATION_eus">Basque</option>
							<option value="TRANSLITERATION_fas">Persian</option>
							<option value="TRANSLITERATION_fin">Finnish</option>
							<option value="TRANSLITERATION_fra">French</option>
							<option value="TRANSLITERATION_fry">Western_Frisian</option>
							<option value="TRANSLITERATION_glg">Galician</option>
							<option value="TRANSLITERATION_guj">Gujarati</option>
							<option value="TRANSLITERATION_hat">Haitian</option>
							<option value="TRANSLITERATION_heb">Hebrew</option>
							<option value="TRANSLITERATION_hrv">Croatian</option>
							<option value="TRANSLITERATION_hsb">Upper_Sorbian</option>
							<option value="TRANSLITERATION_hun">Hungarian</option>
							<option value="TRANSLITERATION_hye">Armenian</option>
							<option value="TRANSLITERATION_ina">Interlingua</option>
							<option value="TRANSLITERATION_ind">Indonesian</option>
							<option value="TRANSLITERATION_isl">Icelandic</option>
							<option value="TRANSLITERATION_jav">Javanese</option>
							<option value="TRANSLITERATION_kat">Georgian</option>
							<option value="TRANSLITERATION_kaz">Kazakh</option>
							<option value="TRANSLITERATION_kbd">Kabardian</option>
							<option value="TRANSLITERATION_kir">Kirghiz</option>
							<option value="TRANSLITERATION_kur">Kurdish</option>
							<option value="TRANSLITERATION_lat">Latin</option>
							<option value="TRANSLITERATION_lav">Latvian</option>
							<option value="TRANSLITERATION_lim">Limburgish</option>
							<option value="TRANSLITERATION_lit">Lithuanian</option>
							<option value="TRANSLITERATION_ltz">Luxembourgish</option>
							<option value="TRANSLITERATION_mai">Maithili</option>
							<option value="TRANSLITERATION_mar">Marathi</option>
							<option value="TRANSLITERATION_mkd">Macedonian</option>
							<option value="TRANSLITERATION_mlg">Malagasy</option>
							<option value="TRANSLITERATION_mon">Mongolian</option>
							<option value="TRANSLITERATION_msa">Malay</option>
							<option value="TRANSLITERATION_mzn">Mazandarani</option>
							<option value="TRANSLITERATION_nah">Nahuatl</option>
							<option value="TRANSLITERATION_nep">Nepali</option>
							<option value="TRANSLITERATION_nno">Norwegian_Nynorsk</option>
							<option value="TRANSLITERATION_oci">Occitan</option>
							<option value="TRANSLITERATION_ori">Oriya</option>
							<option value="TRANSLITERATION_oss">Ossetian</option>
							<option value="TRANSLITERATION_pan">Punjabi</option>
							<option value="TRANSLITERATION_pol">Polish</option>
							<option value="TRANSLITERATION_por">Portuguese</option>
							<option value="TRANSLITERATION_que">Quechua</option>
							<option value="TRANSLITERATION_roh">Romansh</option>
							<option value="TRANSLITERATION_ron">Romanian</option>
							<option value="TRANSLITERATION_rus">Russian</option>
							<option value="TRANSLITERATION_scn">Sicilian</option>
							<option value="TRANSLITERATION_sco">Scots</option>
							<option value="TRANSLITERATION_slk">Slovak</option>
							<option value="TRANSLITERATION_slv">Slovenian</option>
							<option value="TRANSLITERATION_som">Somali</option>
							<option value="TRANSLITERATION_spa">Castilian</option>
							<option value="TRANSLITERATION_sqi">Albanian</option>
							<option value="TRANSLITERATION_srp">Serbian</option>
							<option value="TRANSLITERATION_sun">Sundanese</option>
							<option value="TRANSLITERATION_swa">Swahili</option>
							<option value="TRANSLITERATION_swe">Swedish</option>
							<option value="TRANSLITERATION_tam">Tamil</option>
							<option value="TRANSLITERATION_tel">Telugu</option>
							<option value="TRANSLITERATION_tgk">Tajik</option>
							<option value="TRANSLITERATION_tgl">Tagalog</option>
							<option value="TRANSLITERATION_tuk">Turkmen</option>
							<option value="TRANSLITERATION_tur">Turkish</option>
							<option value="TRANSLITERATION_ukr">Ukrainian</option>
							<option value="TRANSLITERATION_urd">Urdu</option>
							<option value="TRANSLITERATION_uzb">Uzbek</option>
							<option value="TRANSLITERATION_vie">Vietnamese</option>
							<option value="TRANSLITERATION_war">Waray</option>
							<option value="TRANSLITERATION_wln">Walloon</option>
							<option value="TRANSLITERATION_yid">Yiddish</option>
							<option value="TRANSLITERATION_zza">Zazaki</option>
						</select>
					</div>
					<div id="hma-transliteration-selector-div" style="display: none">
						<select class="selectpicker" id="hma-transliteration-selector" data-actions-box="true" data-live-search="true"
								data-header="HMA-Transliteration Language: ">
							  <option style="display:none" value="HMA_TRANSLIT" selected></option>
							  <option value="HMA_TRANSLIT_hi">Hindi</option>
							  <option value="HMA_TRANSLIT_bn">Bengali</option>
							  <option value="HMA_TRANSLIT_kn">Kannada</option>
							  <option value="HMA_TRANSLIT_he">Hebrew</option>
							  <option value="HMA_TRANSLIT_ta">Tamil</option>
							  <option value="HMA_TRANSLIT_pa">Punjabi</option>
							  <option value="HMA_TRANSLIT_hy">Armenian</option>
						</select>
					</div>
					<div id="neural-xel-selector-div" style="display: none">
						<select class="selectpicker" id="neural-xel-selector" data-actions-box="true" data-live-search="true"
								data-header="Entity Linking Language: ">
							<option value="NEURAL_XEL_de">German</option>
							<option value="NEURAL_XEL_es">Spanish</option>
							<option value="NEURAL_XEL_fr">French</option>
							<option value="NEURAL_XEL_it">Italian</option>
							<option value="NEURAL_XEL_zh">Chinese</option>
						</select>
					</div>
				</div>
				<div class="col-md-8 text-right">
					
					
					<div class="dropdown">
						<button id = "random-example-button" class="btn btn-primary">Random Example</button>
						
						<button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1"
						data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
							Sample Documents
							<span class="caret"></span>
						</button>

						<ul class="dropdown-menu dropdown-menu-right" id="dropdownMenuArea1" aria-labelledby="dropdownMenu1">
						</ul>
							
					</div>
					 
				</div>
			</div>
		


	<div id="input-area" style="width: 100%">
          <textarea id="viz-text" maxlength="1500" rows="8" cols="80" style="width: 100%"
                    class="form-control"> </textarea>
          <br>
          <input type="submit" class="btn btn-success" id="viz-submit">
          
          
          <button type="button" class="btn btn-default" data-toggle="popover" title="Share the content"
                  data-html="true" id="main-popover" data-content="">Link to page
          </button>
	</div>
	<div id="render-area"></div>
      </div>
      <div class="alert alert-danger" id="comeLater" style="text-align: center; display: none" role="alert">
	Servers unresponsive. Come back later!
	<div><img src="why3.png" alt="Why....." style="height: 200px; margin-top: 10px"></div>
      </div>
      <div class="alert alert-danger" id="warning" style="text-align: center; display: none" role="alert">
	Warning: external-annotations server is off Ugh.
      </div>
      <textarea id="svg-code" style="height: 0.0cm; opacity: 0.0"></textarea>

      <div class="panel-group" id="accordion">
	<div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">Calling the pipeline from Java</a>
            </h4>
          </div>
          <div id="collapse1" class="panel-collapse collapse">
            <div class="panel-body">
              First you have to add it as a dependency to your project. If this package is used in maven, please add the following dependencies with proper repositories.
              <pre>
		<code class="xhtml" id="maven-snippet"></code></pre>
              <br>
              To process text input use the following pattern:
              <pre><code class="java">import edu.illinois.cs.cogcomp.annotation.AnnotatorService;
		  import edu.illinois.cs.cogcomp.core.datastructures.textannotation.TextAnnotation;
		  import edu.illinois.cs.cogcomp.pipeline.main.PipelineFactory;

		  String docId = "APW-20140101.3018"; // arbitrary string identifier
		  String textId = "body"; // arbitrary string identifier
		  String text = "Hello, how are you. I am doing fine"; // contains plain text to be annotated

		  AnnotatorService pipeline = PipelineFactory.buildPipeline(ViewNames.POS);
		  TextAnnotation ta = pipeline.createAnnotatedTextAnnotation( docId, textId, text );
		  System.out.println(ta.getAvailableViews()); // here you should see that the required views are added.
		  System.out.println(ta.getView(ViewNames.POS).getConstituents()); // will produce (UH Hello) (, ,) (WRB how) (VBP are) (PRP you) (. .) (PRP I) (VBP am) (VBG doing) (JJ fine)
	      </code></pre>
              <br>

              The output of this will be a tokenized document. If you want to add more views, you have to specify them either as arguments of buildPipeline.
              The method returns a `TextAnnotation` data structure , which contains a `View` corresponding to each annotation source. Each `View` contains a set of `Constituents` representing the annotator output. Here is how you can access views:
              <pre><code class="java">import edu.illinois.cs.cogcomp.core.datastructures.ViewNames;

		  System.out.println(ta.getAvailableViews()); // here you should see that the required views are added.
		  System.out.println(ta.getView(ViewNames.POS).getConstituents()); // will produce (UH Hello) (, ,) (WRB how) (VBP are) (PRP you) (. .) (PRP I) (VBP am) (VBG doing) (JJ fine)
	      </code></pre>



              Take a look at our documentations to see more details. <button type="button" onclick="location.href='http://cogcomp.github.io/cogcomp-nlp/pipeline/';"
                                                                             class="btn btn-danger btn-xs">Read More</button>
            </div>
          </div>
	</div>
	<div class="panel panel-default">
          <div class="panel-heading">
            <h4 class="panel-title">
              <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">Calling the pipeline from Python</a>
            </h4>
          </div>
          <div id="collapse2" class="panel-collapse collapse">
            <div class="panel-body">
              <div class="panel-body">First make sure you have "pip" on your system. Then install the package with "pip":
                <pre><code class="bash">pip install cython
		    pip install ccg_nlpy</code></pre>

                <br>
                Here is a sample usage showing how to run our system:
                <pre><code class="python">from ccg_nlpy import remote_pipeline

		    pipeline = remote_pipeline.RemotePipeline()
		    doc = pipeline.doc("Hello, how are you. I am doing fine")
		    print(doc.get_lemma) # will produce (hello Hello) (, ,) (how how) (be are) (you you) (. .) (i I) (be am) (do doing) (fine fine)
		    print(doc.get_pos) # will produce (UH Hello) (, ,) (WRB how) (VBP are) (PRP you) (. .) (PRP I) (VBP am) (VBG doing) (JJ fine)
		</code></pre>

                Take a look at our documentations to see more details. <button type="button" onclick="location.href='https://cogcomp.github.io/cogcomp-nlpy/';"
                                                                               class="btn btn-danger btn-xs">Read More</button>
              </div>
            </div>
	  </div>
	</div>
	<br>
	<div id="bottom"></div>
	<div class="alert alert-warning" style="text-align: center" role="alert">
	  Problems? Use our <a href="https://github.com/CogComp/cogcomp-nlp/issues">issue tracker</a>.
	</div>
      </div>
      <div id="render-info" style="visibility: hidden;">{{_content_rendered_}}</div>
      <div id="sample-sentence-data" style="visibility: hidden;">{{sampleSentences}}</div>
      <div id="render-text" style="visibility: hidden;">{{text}}</div>
      <div id="render-views" style="visibility: hidden;">{{viewNames}}</div>

      <script type="text/javascript">

	$(document).ready(function() {
            $('pre code').each(function(i, block) {
		hljs.highlightBlock(block);
            });
	});

	var clipboard = new apelles.cb('.btn'); // copy to the clipboard initialization
	clipboard.on('success', function (e) {
            e.clearSelection();
	});

	var page_rendered = true;
	if ($("#render-info").text().includes("_content_rendered_")) {
            page_rendered = false;
	}
    
	

	var pipelineServer = "http://macniece.seas.upenn.edu:4001/annotate";
	var pipelineServerVersionAPI = "http://macniece.seas.upenn.edu:4001/version";
	var externalAnnotatorServers = [
            "http://bronte.cs.illinois.edu:1503/annotate", // stanford
            "http://bronte.cs.illinois.edu:8009/annotate", // neural-xel
            "http://macniece.seas.upenn.edu:4003/annotate", // hma transliteration
            "http://localhost:5000/annotate" // for testing purposes with the python server wrapper
	];

	function httpGetAsync(theUrl, callback) {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.onreadystatechange = function() {
		if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
                    $("#pipeline-version").html(xmlHttp.responseText);
                    var mavenSnippet = `&lt;dependencies&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;edu.illinois.cs.cogcomp&lt;/groupId&gt;
        &lt;artifactId&gt;illinois-nlp-pipeline&lt;/artifactId&gt;
        &lt;version&gt;` + xmlHttp.responseText + `&lt;/version&gt;
    &lt;/dependency&gt;
&lt;/dependencies&gt;
&lt;repositories&gt;
    &lt;repository&gt;
        &lt;id&gt;CogcompSoftware&lt;/id&gt;
        &lt;name&gt;CogcompSoftware&lt;/name&gt;
        &lt;url&gt;http://cogcomp.org/m2repo/&lt;/url&gt;
    &lt;/repository&gt;
&lt;/repositories&gt;`;

                    $("#maven-snippet").html(mavenSnippet);

		}
            };
            xmlHttp.open("GET", theUrl, true); // true for asynchronous
            xmlHttp.send(null);
	}

	httpGetAsync(pipelineServerVersionAPI);

	// for each external annotator, add a loader
	externalAnnotatorServers.forEach(function (item, i) {
            var loaderDiv = $("#loader_container");
            loaderDiv.append("<div class='loader' id='loader-ex-" + i + "'></div>");
	});

	// Return an array of the selected opion values
	// select is an HTML select element
	function getSelectValues(select) {
		var result = [];
		var options = select && select.options;
		var opt;
		for (var i = 0, iLen = options.length; i < iLen; i++) {
			opt = options[i];
			if (opt.selected) {
						result.push(opt.value || opt.text);
			}
		}
		return result;
	}

	/**
	 * @param select is the selector object
	 * @param viewNames is a Set
	 */
	function setSelectValues(select, viewNames) {
            var options = select && select.options;
            for (var i = 0, iLen = options.length; i < iLen; i++) {
		if (viewNames.has(options[i].value)) {
                    options[i].setAttribute("selected", "true");
                    options[i].selected = true;
		}
		else {
                    options[i].setAttribute("selected", "false");
                    options[i].selected = false;
		}
            }
	}
    
    

	fetch(pipelineServer)
    .then(function () {
        console.log("Connection works. ");
    }).catch(function () {
        document.getElementById("comeLater").style.display = "block";
    });

	externalAnnotatorServers.forEach(function (url) {
            fetch(url)
		.then(function () {
		    console.log("Connection works. ");
		}).catch(function () {
		    document.getElementById("warning").style.display = "block";
		});
	});

	
	head.ready(function () {
            console.log('Loading and rendering');

            const _ = apelles.lodash;

            const bratLocation = './brat_client';
            const brat_options = {
		'brat_util': Util,
		'brat_webFontURLs': [
                    bratLocation + '/static/fonts/PT_Sans-Caption-Web-Regular.ttf',
                    bratLocation + '/static/fonts/Liberation_Sans-Regular.ttf'
		]
            };

        
        var area = $("#dropdownMenuArea1");    
		var allSentences = [];
		var sampleSentences = [];
	
        var SampleSentencesjson = apelles.getSampleSentences();
		var tagDict = {};
        $.each(SampleSentencesjson, function(index, record) 
        {
            //index is the key,
            allSentences.push(index);
            
			var l;
			$.each(record, function(key, value)
			{
				if(value in tagDict)
				{
					l = tagDict[value]
				}
				else
				{
					var  l = []
				}
				
				l.push(index);
				tagDict[value] = l;
			});
            
        });
        sampleSentences = allSentences;
		
        function filterSampleSentences()
		{
			
			var allTags = document.getElementById('view-selector'), tag, i;


			var tagArrays = [];

			sampleSentences = allSentences;
			for(i = 0; i < allTags.length; i++) 
			{
				tag = allTags[i];
				
				if (tag.selected) 
				{
					var value = tagDict[tag.value];
					if(value==null)
						value = [];
					tagArrays.push(value);
				}
			}
			if(tagArrays.length>0)
				sampleSentences = tagArrays.reduce((a, b) => a.filter(c => b.includes(c)));


			updateSampleSentencesDropDown(sampleSentences);
		}
		
        function updateSampleSentencesDropDown(sampleSentences)
        {
            //clears the options
            area.empty();
            
            // fill out the senetnces to the dropdown
            $.each(sampleSentences, function(i, sent) 
            {
                var sentence = sent;
                if (sent.length > 50) 
                {
                    sentence = sent.substring(0, 50) + " ...";
                }
                area.append("<li><a href='#' id='action-" + i + "'>" + sentence + "</a></li>");
               
                // set the sentence in the text-area
                jQuery("#action-" + i).click(function (e) {
                            e.preventDefault();
                            $("#viz-text").val(sent);
                });
            });
            
			/*
            //clear text area if
            if(sampleSentences.length == 0)
            {
                $("#viz-text").val("");
            }
            
            */
        }
        
        
        $('.selectpicker').on('change', function () 
        {
            if ($("#trans-opt")[0].selected) 
            {
                $("#transliteration-selector-div").css("display", "inline");
            }
            else
            {
                $("#transliteration-selector-div").css("display", "none");
            }
            if ($("#hma-trans-opt")[0].selected) 
            {
                $("#hma-transliteration-selector-div").css("display", "inline");
            }
            else
            {
                $("#hma-transliteration-selector-div").css("display", "none");
            }
            if ($("#neural-xel-opt")[0].selected) 
            {
                $("#neural-xel-selector-div").css("display", "inline");
            }
            else
            {
                $("#neural-xel-selector-div").css("display", "none");
            }
            
            
            filterSampleSentences();
            
        });
        
        updateSampleSentencesDropDown(allSentences);
		//sets the default text in the text area to be the first example
		$("#viz-text").val(allSentences[0]);
		
        if (page_rendered) 
		{
			$("#viz-text").val($("#render-text").text());
			// select the views
			
			var viewNamesToCheck = $("#render-views").text().split(",");
			setSelectValues(document.getElementById('view-selector'), new Set(viewNamesToCheck));
			updatePage();
        }

		function getAllActiveViews() {
			var optionsMainpipeline = getSelectValues(document.getElementById('view-selector'));
			console.log(optionsMainpipeline);

			var optionsTransliteration = getSelectValues(document.getElementById('transliteration-selector'));
			console.log(optionsTransliteration);
			optionsMainpipeline = optionsMainpipeline.concat(optionsTransliteration);

			var optionsHMATransliteration = getSelectValues(document.getElementById('hma-transliteration-selector'));
			console.log(optionsHMATransliteration);
			optionsMainpipeline = optionsMainpipeline.concat(optionsHMATransliteration);

			var optionsXEL = getSelectValues(document.getElementById('neural-xel-selector'));
			console.log(optionsXEL);
			optionsMainpipeline = optionsMainpipeline.concat(optionsXEL);

			return optionsMainpipeline;
			/*.filter(function (e) {
					 return e !== 'TRANSLITERATION'
			 });*/
		}

		function getDynamicLink() 
		{
			console.log("dynamic link!!!");
			var views = getAllActiveViews().join();
			var text = $("#viz-text").val();
			return "http://nlp.cogcomp.org/render?text=" + text + "&viewNames=" + views;
		}

		// set popover with links
		$('[data-toggle="popover"]').popover();
		var htmlContent = "Dymanic link: <input type='text' onfocus='this.select();' id='dynamic-link' onmouseup='return false;' style='width: 180pt'/>";
		$("#main-popover").attr("data-content", htmlContent);
		$("#main-popover").click(function () {
			var link = getDynamicLink();
			console.log(link);
			$("#dynamic-link").val(link);
		});

		function updatePage() {
			// loader active
			document.getElementById("loader-main").style.visibility = "visible";
			externalAnnotatorServers.forEach(function (url, i) {
				document.getElementById("loader-ex-" + i).style.visibility = "visible";
			});
			var pipelineViews = getAllActiveViews();

			var text = $("#viz-text").val();
			//console.log("Submit event: ");
			//console.log(text);
			//console.log($("#viz-text"));
			//console.log("pipelineViews: ");
			//console.log(pipelineViews);

			function sendRequest(api, loaderId) {
				var p = text ? Promise.resolve(text) : Promise.reject("Invalid Text");
				p.then(function (text) {
					$("#render-area").empty();

//console.log("text: " + text);
					//console.log("pipelineViews: " + pipelineViews);
					return apelles.pipelineClient.annotateText({}, text, pipelineViews, api).then(function (jsonData) {
					//console.log("jsonData: " + jsonData);
						return jsonData;
					}, function (err) {
						// return empty annotation
						return [];
					});
				}).then(function (jsonData) {

					var availableViews = apelles.getAvailableViews(jsonData);
					var obj = availableViews[0]
//console.log("availableViews: " + Object.keys(obj));

					var viewInfos = _.filter(availableViews, function (viewInfo) {
						return $.inArray(viewInfo.type, apelles.supportedTypes) !== -1 && viewInfo.name !== "TOKENS";

					});

					_.forEach(viewInfos, function (viewInfo) {

						if (!pipelineViews.includes(viewInfo.name)) return;


						//console.log("Rendering: " + viewInfo.name);
						var divId = viewInfo.name;
						var newDiv = createViewArea(divId, viewInfo.name, viewInfo.type);

						//console.log(newDiv[0]);
						//console.log(newDiv[0].nodeType); 
						// target element that we will observe
						const target = newDiv[0];

						// config object
						const config = {
						  attributes: true,
						  attributeOldValue: true,
						  characterData: true,
						  characterDataOldValue: true,
						  childList: true,
						  subtree: true
						};

						// subscriber function
						function subscriber(mutations) {
						  mutations.forEach((mutation) => {
							// handle mutations here
							
							if(mutation.oldValue =='' && mutation.target.nodeName=='DIV')
							{
								//console.log(mutation.target.lastChild.nodeName);
								//console.log(mutation);
								//console.log("mutation handle");
								addPossibleLinks();
							}
						  });
						}

						// instantiating observer
						const observer = new MutationObserver(subscriber);

						// observing target
						observer.observe(target, config);
						$("#render-area").append(newDiv).ready(function () {

						});

//console.log("viewInfo " + Object.keys(viewInfo));
						apelles.render(jsonData, divId, viewInfo, brat_options).then(function () {

//console.log("after "+divId);
//console.log("after render");
						});


					});
					document.getElementById(loaderId).style.visibility = "hidden";


					$("#render-info").text("_content_rendered_");

				}, function (err) {
					// do nothing

				});
			}

			// main server
			sendRequest(pipelineServer, "loader-main");

			// external annotations server
			externalAnnotatorServers.forEach(function (url, i) {
				sendRequest(url, "loader-ex-" + i);


			});
		}

		var createViewArea = function (renderDivId, viewName, viewType) {
			var outerDiv = $("<div>").attr("class", "view-area");
			//outerDiv.append("<p>yoyoyoyoy</p>");
			var newblock = $("<div class='alert alert-success alert-success fade in visualization-block' role='alert'>").attr("id", renderDivId);

			var viewTypeShort = viewType.split(".").pop();
			var text = " <b> View Name: </b> " + viewName + ", <b>View Type: </b> " + viewTypeShort;
			var dropup = "<div class='dropup' id='dropup'> " +
				"<button class='btn btn-sm btn-success dropdown-toggle' type='button' data-toggle='dropdown'>" +
				"<span class='caret'></span></button> <ul class='dropdown-menu'> " +
				//              "<li><a href='#' onclick='downloadImage(`" + viewName + "`);'>Download as PNG</a></li>" +
				'<li><button class="btn" data-clipboard-action="cut" data-clipboard-target="#svg-code" style="background-color: transparent; color: #333" onclick="return setTextArea(`' + viewName + '`);">Copy embeddable html to clipboard</button> </li>' +
				"</ul>" +
				"</div>";
			var closeButton = "<a href='' class='close' data-dismiss='alert' aria-label='close'><b>Ã—</b></a>";
			var headerContent = "<form class='form-inline' role='form'> <div class='form-group'> " + dropup +
				"</div><div class='form-group' style='margin-left: 0.3cm'>" + text + "</div>" + closeButton + "</form>";
			newblock.append(headerContent);
			outerDiv.append(newblock);
			
			//console.log("added");
			//setTimeout(addPossibleLinks, 500);

			return outerDiv;
		};

		$("#viz-submit").click(
			function (eventData) {
				updatePage()
				newLinksToCheck = true;
				//alert("clicked");
			}
		);
			
		$("#random-example-button").click(
			function (eventData) {
				
				if(sampleSentences.length==0)
					return;
				var ranIndex = Math.floor(Math.random()*sampleSentences.length);
				var randomElement = sampleSentences[ranIndex];
				$("#viz-text").val(randomElement);
			}
		);
		
	});

		function sleep(time) {

			return new Promise((resolve) => setTimeout(resolve, time));
		}

		var newLinksToCheck = true;

		function setTextArea(id) {
			var mySVG = $("#" + id)[0];
			var text = mySVG.innerHTML;
			text = '<link rel="stylesheet" type="text/css" href="http://nlp.cogcomp.org/embed.css">' + text.substring(text.indexOf("<svg"));
			text = text.replace("width: 908px; ", "");
			$("#svg-code").val(text);
			console.log(text);
			return false;
		}



		function addPossibleLinks() 
		{
			var toBeWrapped = document.getElementsByTagName("text");
			//alert(toBeWrapped.length);

			var wrappers = [];


			if (toBeWrapped.length > 0) {
				//alert("mutations");
				if (newLinksToCheck == true) {
					for (var index = 0; index < toBeWrapped.length; index++) {
						if (!toBeWrapped[index].children || toBeWrapped[index].children.length == 0 && toBeWrapped[index].nextSibling && toBeWrapped[index].nextSibling.tagName == "path") {
							var someText = toBeWrapped[index];

							if (someText.innerHTML.includes("en.wikipedia.org")) {
								someText.setAttribute("fill", "blue");

								var node = toBeWrapped[index].previousSibling;


								wrapper = document.createElement("a");
								//alert(node.nodeName);


								wrapper.href = "https://" + someText.innerHTML;

								wrapper.target = "_blank";
								
								var oldparent = node.parentNode;

								oldparent.insertBefore(wrapper, node);


								oldparent.removeChild(node);
								wrapper.appendChild(node)
								//console.log(wrapper.nodeName);
								//alert(node.nodeName);

								var tmp = document.createElement("div");
								tmp.appendChild(wrapper);

								oldparent.innerHTML = tmp.innerHTML + oldparent.innerHTML;
							}
						}

					}
					//dont check anything until submit gets clicked again
					newLinksToCheck = false;
				}
			}
		}

	</script>
  </body>
</html>
